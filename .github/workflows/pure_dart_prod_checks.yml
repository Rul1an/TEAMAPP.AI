name: Pure Dart Prod Checks

on:
  workflow_dispatch:
  schedule:
    - cron: '0 3 * * *'

jobs:
  prod-checks:
    runs-on: ubuntu-latest
    concurrency:
      group: prod-dart-checks
      cancel-in-progress: true
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Dart
        uses: dart-lang/setup-dart@v1
        with:
          sdk: 'stable'

      - name: Export Production Env
        run: |
          echo "SUPABASE_URL=${{ secrets.SUPABASE_URL_PROD }}" >> $GITHUB_ENV
          echo "SUPABASE_ANON_KEY=${{ secrets.SUPABASE_ANON_KEY_PROD }}" >> $GITHUB_ENV
          echo "APP_BASE=https://teamappai.netlify.app" >> $GITHUB_ENV

      - name: Install dependencies
        working-directory: jo17_tactical_manager
        run: dart pub get

      - name: Run networked security tests (Dart)
        working-directory: jo17_tactical_manager
        run: |
          # Run only dart-only suites; skip widget/integration to avoid HttpClient binding 400s
          dart test -r expanded test/security/minimal_database_audit_test.dart test/security/database_audit_phase2_live_validation_test.dart || true


