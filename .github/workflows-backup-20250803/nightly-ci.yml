name: ðŸŒ™ Nightly Quality Assurance

on:
  schedule:
    - cron: '0 2 * * *'  # Daily at 2 AM UTC
  workflow_dispatch:  # Allow manual trigger

jobs:
  comprehensive-testing:
    name: ðŸ§ª Full Test Suite
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: ðŸ“± Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.32.x'
          channel: stable
          cache: true

      - name: ðŸ”§ Install Dependencies
        run: flutter pub get

      - name: ðŸŽ¯ E2E Tests
        run: flutter test integration_test/
        continue-on-error: true

      - name: âš¡ Performance Benchmarks
        run: |
          flutter test test/performance/ --reporter json > performance-results.json
          echo "ðŸ“Š Performance results saved"
        continue-on-error: true

      - name: ðŸ”’ Security Scan with CodeQL
        uses: github/codeql-action/init@v3
        with:
          languages: dart

      - name: ðŸ”’ Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v3

      - name: ðŸ“ˆ Dependency Audit
        run: |
          flutter pub deps
          dart pub audit
        continue-on-error: true

      - name: ðŸ“Š Upload Performance Results
        uses: actions/upload-artifact@v4
        with:
          name: performance-results
          path: performance-results.json
        if: always()
